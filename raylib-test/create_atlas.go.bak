package main

import (
	"fmt"

	rl "github.com/gen2brain/raylib-go/raylib"
)

func main() {
	// Inicializar janela (necessário para operações de imagem)
	rl.SetConfigFlags(rl.FlagWindowHidden)
	rl.InitWindow(1, 1, "Atlas Creator")
	defer rl.CloseWindow()

	// Carregar as duas texturas
	tex1 := rl.LoadImage("../texture1.png")
	if tex1.Width == 0 {
		fmt.Println("Erro ao carregar texture1.png")
		return
	}
	defer rl.UnloadImage(tex1)

	tex2 := rl.LoadImage("../texture2.png")
	if tex2.Width == 0 {
		fmt.Println("Erro ao carregar texture2.png")
		return
	}
	defer rl.UnloadImage(tex2)

	fmt.Printf("Texture 1: %dx%d\n", tex1.Width, tex1.Height)
	fmt.Printf("Texture 2: %dx%d\n", tex2.Width, tex2.Height)

	// Criar atlas 2x1 (2 texturas lado a lado)
	atlasWidth := tex1.Width + tex2.Width
	atlasHeight := tex1.Height
	if tex2.Height > atlasHeight {
		atlasHeight = tex2.Height
	}

	// Criar imagem do atlas
	atlas := rl.GenImageColor(int(atlasWidth), int(atlasHeight), rl.Blank)
	defer rl.UnloadImage(atlas)

	// Desenhar texture1 na posição (0, 0)
	rl.ImageDraw(atlas, tex1,
		rl.NewRectangle(0, 0, float32(tex1.Width), float32(tex1.Height)),
		rl.NewRectangle(0, 0, float32(tex1.Width), float32(tex1.Height)),
		rl.White)

	// Desenhar texture2 na posição (tex1.Width, 0)
	rl.ImageDraw(atlas, tex2,
		rl.NewRectangle(0, 0, float32(tex2.Width), float32(tex2.Height)),
		rl.NewRectangle(float32(tex1.Width), 0, float32(tex2.Width), float32(tex2.Height)),
		rl.White)

	// Salvar atlas
	success := rl.ExportImage(*atlas, "voxel_atlas.png")
	if success {
		fmt.Printf("Atlas criado com sucesso: voxel_atlas.png (%dx%d)\n", atlasWidth, atlasHeight)
		fmt.Println("Textura 0: Azul (posição 0)")
		fmt.Println("Textura 1: Verde (posição 1)")
	} else {
		fmt.Println("Erro ao salvar atlas")
	}
}
